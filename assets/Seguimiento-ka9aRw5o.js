import{b as r,j as e}from"./index-zJlaE_HK.js";import{C as _}from"./Card-C-Mn8nma.js";import{S}from"./toast-B7PgVsN2.js";import{C,M as G,A as V,c as B,b as W}from"./MonitoreService-he35y15f.js";import{bb as K}from"./Drawer-B_J86z6-.js";import"./Button-C6uDY6Lx.js";import"./FormContainer-4XNfbORA.js";import"./uniqueId-FWsYeQHm.js";import{S as q}from"./Select-BBW6A9hW.js";import{p as R}from"./promedio-CLmepkPx.js";const y={campagin:[440,505,414,671,227,413,201,352,752,320,257,160],email:[23,42,35,27,43,22,17,31,22,22,12,16],label:["01 Jan","02 Jan","03 Jan","04 Jan","05 Jan","06 Jan","07 Jan","08 Jan","09 Jan","10 Jan","11 Jan","12 Jan"]},k=[{tooltip:"PPRD",text:"PPRD"},{tooltip:"EVAR",text:"EVAR"},{tooltip:"Educación comunitaria",text:"EC"},{tooltip:"Reasentamiento poblacional",text:"RP"},{tooltip:"Planes de reconstrucción",text:"PR"},{tooltip:"Gestión Ambiental",text:"GA"},{tooltip:"Acondicionamiento territorial",text:"AT"},{tooltip:"Desarrollo urbano",text:"DU"},{tooltip:"Ordenamiento territorial",text:"OT"},{tooltip:"Plan Estratégico Institucional (PEI)",text:"PEI"},{tooltip:"Plan Operativo Institucional (POI)",text:"POI"},{tooltip:"Plan Estratégico Sectorial Multianual (PESEM)",text:"PESEM"},{tooltip:"Manual de Organización y Funciones (MOF)",text:"MOF"},{tooltip:"Reglamento de Organización y Funciones (ROF)",text:"ROF"},{tooltip:"Planes de Desarrollo Concertado (PDC)",text:"PDC"},{tooltip:"Planes de Desarrollo Local (PDL)",text:"PDL"}],M=u=>{const o=Array(k.length).fill(0);return u.forEach(c=>c.forEach((m,s)=>o[s]+=m)),o};function Q(u){let o=[];const c=m=>m.map(s=>s.respuesta.toLowerCase()==="si"?1:0);for(let m=0;m<u.length;m++){const s=u[m],g=o.findIndex(h=>h.id==s.departamento_iddpto);if(g===-1){o.push({id:s.departamento_iddpto,nombre:s.departamento.nombre,provincias:[{id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)}]}]});continue}const v=o[g].provincias.findIndex(h=>h.id==s.provincia_idprov);if(v===-1){o[g].provincias.push({id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)}]});continue}const N=o[g].provincias[v].distritos.findIndex(h=>h.id==s.ubigeo);if(N===-1){o[g].provincias[v].distritos.push({id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)});continue}o[g].provincias[v].distritos[N].valores=c(s.respuestas)}return o}function ne(){const[u,o]=r.useState(new Set),[c,m]=r.useState([]),[s,g]=r.useState([]),[v,N]=r.useState(null),[h,E]=r.useState(!0),[T,D]=r.useState("Peru");async function A(t){t&&(E(!0),N(t),await O(t.value),E(!1))}async function O(t){const a=await B(t);m(Q(a))}async function I(){const t=await W();g(t.map(i=>({value:String(i.id),label:i.nombre})));const a=t[0];N({value:String(a.id),label:a.nombre}),await O(String(a.id)),E(!1)}r.useEffect(()=>{I()},[]);const $=t=>{const a=new Set(u);a.has(t)?a.delete(t):a.add(t),o(a)},{provTotals:J,depTotals:F}=r.useMemo(()=>{const t=new Map,a=new Map;for(const i of c){const p=[],n=[];for(const x of i.provincias){const l=M(x.distritos.map(b=>b.valores)),f=x.distritos.map(b=>b.valores),P=R(f,b=>b==1);t.set(x.id,{cols:l,total:P}),p.push(...x.distritos.map(b=>b.valores)),n.push(P)}const j=M(p),w=n.reduce((x,l)=>x+l,0);a.set(i.id,{cols:j,total:Number((w/n.length).toFixed(2))})}return{provTotals:t,depTotals:a}},[c]),[d,L]=r.useState("all"),z=r.useMemo(()=>{const t={name:"Campaign (ROI)",type:"column",data:y.campagin,color:function({dataPointIndex:i,value:p}){return i>0&&p<y.campagin[i-1]?C[7]:C[9]}},a={name:"Email (ROI)",type:"line",data:y.email,color:C[0]};return d==="all"?[t,a]:d==="campagin"?[t]:d==="email"?[a]:[]},[d]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-center",children:e.jsx(q,{options:s,value:v,onChange:t=>A(t),isDisabled:h})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:e.jsxs("table",{className:"table-fixed border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 min-w-[240px] max-w-[240px] bg-slate-50 p-3 text-left text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:"Localización"}),k.map(t=>e.jsx("th",{className:"bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:e.jsx(K,{title:t.tooltip,children:e.jsx("span",{className:"cursor-pointer",children:t.text})})},t.text)),e.jsx("th",{className:"whitespace-nowrap w-[120px] bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200 whitespace-nowrap",children:"Total %"})]})}),e.jsx("tbody",{children:c.map(t=>{const a=`D:${t.id}`,i=u.has(a),p=F.get(t.id);return e.jsxs(r.Fragment,{children:[e.jsxs("tr",{className:"bg-amber-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{$(a),D(`${t.nombre}, Peru`)},"aria-expanded":i,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${i?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:t.nombre})]})}),p?.cols?.map((n,j)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:n},j)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:p?.total})]}),i&&t.provincias.map(n=>{const j=`P:${n.id}`,w=u.has(j),x=J.get(n.id);return e.jsxs(r.Fragment,{children:[e.jsxs("tr",{className:"bg-cyan-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 pl-10 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{$(j),D(`${n.nombre}, ${t.nombre}, Peru`)},"aria-expanded":w,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${w?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:n.nombre})]})}),x.cols.map((l,f)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:l},f)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:x.total})]}),w&&n.distritos.map(l=>e.jsxs("tr",{className:"hover:bg-slate-50 bg-emerald-50",children:[e.jsx("td",{onClick:()=>{D(`${l.nombre}, ${n.nombre}, ${t.nombre}, Peru`)},className:"sticky left-0 z-10 p-3 pl-22 ring-1 ring-slate-200",children:e.jsx("span",{className:"ml-2 text-sm text-slate-800 underline decoration-emerald-300",children:l.nombre})}),l.valores.map((f,P)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:f},P)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:R([l.valores],f=>f==1)})]},l.id))]},n.id)})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"bg-white p-3 text-right text-[11px] text-slate-500 ring-1 ring-slate-200"}),e.jsxs("td",{colSpan:k.length,className:"bg-white p-3 text-center text-[11px] text-slate-500 ring-1 ring-slate-200",children:["Valor de clasificación:"," ",e.jsx("span",{className:"font-medium",children:"0 / 1"})]}),e.jsx("td",{className:"bg-white p-3 ring-1 ring-slate-200"})]})})]})})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6 items-stretch",children:[e.jsx("div",{className:"relative min-h-[450px] rounded-xl overflow-hidden ring-1 ring-slate-200 bg-slate-100",children:e.jsx(G,{query:T})}),e.jsxs(_,{className:"h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{children:"Ads performance"}),e.jsx("div",{children:e.jsxs(S,{className:"gap-1",value:d,size:"sm",onChange:t=>L(t),children:[e.jsx(S.Item,{value:"all",children:"All"}),e.jsx(S.Item,{value:"campagin",children:"Campagin"}),e.jsx(S.Item,{value:"email",children:"Email"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(V,{options:{chart:{type:"line",zoom:{enabled:!1},toolbar:{show:!1}},legend:{show:!1},stroke:{width:d==="email"?2.5:[0,2.5],curve:"smooth",lineCap:"round"},states:{hover:{filter:{type:"none"}}},tooltip:{custom:({series:t,dataPointIndex:a})=>{const i=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${C[9]}"></div>
                  <div class="flex gap-2">Campaign: <span class="font-bold">${t[0][a]}</span></div>
                </div>`,p=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${C[0]}"></div>
                  <div class="flex gap-2">Email: <span class="font-bold">${t[d==="all"?1:0][a]}</span></div>
                </div>`,n=d==="all"?`${i()}${p()}`:d==="campagin"?i():p();return`
                <div class="py-2 px-4 rounded-xl">
                  <div class="flex flex-col gap-2">
                    <div>${y.label[a]}</div>
                    ${n}
                  </div>
                </div>`}},labels:y.label,yaxis:d==="all"?[{},{opposite:!0}]:[],plotOptions:{bar:{horizontal:!1,columnWidth:"35px",borderRadius:4,borderRadiusApplication:"end"}}},series:z,height:450})})]})]})]})}export{ne as default};
