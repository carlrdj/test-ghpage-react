import{b as o,j as e}from"./index-Di-6ARBW.js";import{C as F}from"./Card-BFZDpZRY.js";import{S as k}from"./toast-C2OIv-hM.js";import{C as y,M as B,A as W,a as G,b as K}from"./MonitoreService-BOuQQSgL.js";import"./Drawer-zII9E4Mt.js";import"./Button-CbN5059T.js";import"./FormContainer-mDHVfeNN.js";import"./uniqueId-B36WFNES.js";import{S as V}from"./Select-DiILCuIS.js";import{p as E}from"./promedio-CLmepkPx.js";const C={campagin:[440,505,414,671,227,413,201,352,752,320,257,160],email:[23,42,35,27,43,22,17,31,22,22,12,16],label:["01 Jan","02 Jan","03 Jan","04 Jan","05 Jan","06 Jan","07 Jan","08 Jan","09 Jan","10 Jan","11 Jan","12 Jan"]},T=Array.from({length:30},(p,n)=>`P${n+1}`),z=p=>{const n=Array(T.length).fill(0);return p.forEach(c=>c.forEach((x,s)=>n[s]+=x)),n};function q(p){let n=[];const c=x=>x.map(s=>s.respuesta.toLowerCase()==="si"?1:0);for(let x=0;x<p.length;x++){const s=p[x],u=n.findIndex(h=>h.id==s.departamento_iddpto);if(u===-1){n.push({id:s.departamento_iddpto,nombre:s.departamento.nombre,provincias:[{id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)}]}]});continue}const v=n[u].provincias.findIndex(h=>h.id==s.provincia_idprov);if(v===-1){n[u].provincias.push({id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)}]});continue}const N=n[u].provincias[v].distritos.findIndex(h=>h.id==s.ubigeo);if(N===-1){n[u].provincias[v].distritos.push({id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.respuestas)});continue}n[u].provincias[v].distritos[N].valores=c(s.respuestas)}return n}function ne(){const[p,n]=o.useState(new Set),[c,x]=o.useState([]),[s,u]=o.useState([]),[v,N]=o.useState(null),[h,$]=o.useState(!0),[L,J]=o.useState("Peru");async function O(t){t&&($(!0),N(t),await M(t.value),$(!1))}async function M(t){const a=await G(t);x(q(a))}async function A(){const t=await K();u(t.map(i=>({value:String(i.id),label:i.nombre})));const a=t[0];N({value:String(a.id),label:a.nombre}),await M(String(a.id)),$(!1)}o.useEffect(()=>{A()},[]);const D=t=>{const a=new Set(p);a.has(t)?a.delete(t):a.add(t),n(a)},{provTotals:R,depTotals:I}=o.useMemo(()=>{const t=new Map,a=new Map;for(const i of c){const m=[],r=[];for(const g of i.provincias){const l=z(g.distritos.map(b=>b.valores)),f=g.distritos.map(b=>b.valores),S=E(f,b=>b==1);t.set(g.id,{cols:l,total:S}),m.push(...g.distritos.map(b=>b.valores)),r.push(S)}const j=z(m),w=r.reduce((g,l)=>g+l,0);a.set(i.id,{cols:j,total:Number((w/r.length).toFixed(2))})}return{provTotals:t,depTotals:a}},[c]),[d,P]=o.useState("all"),_=o.useMemo(()=>{const t={name:"Campaign (ROI)",type:"column",data:C.campagin,color:function({dataPointIndex:i,value:m}){return i>0&&m<C.campagin[i-1]?y[7]:y[9]}},a={name:"Email (ROI)",type:"line",data:C.email,color:y[0]};return d==="all"?[t,a]:d==="campagin"?[t]:d==="email"?[a]:[]},[d]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-center",children:e.jsx(V,{options:s,value:v,onChange:t=>O(t),isDisabled:h})}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-[1000px] table-fixed border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 min-w-[240px] max-w-[240px] bg-slate-50 p-3 text-left text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:"Localización"}),T.map(t=>e.jsx("th",{className:"bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:t},t)),e.jsx("th",{className:"w-[120px] bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200 whitespace-nowrap",children:"Total %"})]})}),e.jsx("tbody",{children:c.map(t=>{const a=`D:${t.id}`,i=p.has(a),m=I.get(t.id);return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{className:"bg-amber-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{D(a),J(`${t.nombre}, Peru`)},"aria-expanded":i,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${i?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:t.nombre})]})}),m?.cols?.map((r,j)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:r},j)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:m?.total})]}),i&&t.provincias.map(r=>{const j=`P:${r.id}`,w=p.has(j),g=R.get(r.id);return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{className:"bg-cyan-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 pl-10 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{D(j),J(`${r.nombre}, ${t.nombre}, Peru`)},"aria-expanded":w,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${w?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:r.nombre})]})}),g.cols.map((l,f)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:l},f)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:g.total})]}),w&&r.distritos.map(l=>e.jsxs("tr",{className:"hover:bg-slate-50 bg-emerald-50",children:[e.jsx("td",{onClick:()=>{J(`${l.nombre}, ${r.nombre}, ${t.nombre}, Peru`)},className:"sticky left-0 z-10 p-3 pl-22 ring-1 ring-slate-200",children:e.jsx("span",{className:"ml-2 text-sm text-slate-800 underline decoration-emerald-300",children:l.nombre})}),l.valores.map((f,S)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:f},S)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:E([l.valores],f=>f==1)})]},l.id))]},r.id)})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"bg-white p-3 text-right text-[11px] text-slate-500 ring-1 ring-slate-200"}),e.jsxs("td",{colSpan:T.length,className:"bg-white p-3 text-center text-[11px] text-slate-500 ring-1 ring-slate-200",children:["Valor de clasificación:"," ",e.jsx("span",{className:"font-medium",children:"0 / 1"})]}),e.jsx("td",{className:"bg-white p-3 ring-1 ring-slate-200"})]})})]})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6 items-stretch",children:[e.jsx("div",{className:"relative min-h-[450px] rounded-xl overflow-hidden ring-1 ring-slate-200 bg-slate-100",children:e.jsx(B,{query:L})}),e.jsxs(F,{className:"h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{children:"Ads performance"}),e.jsx("div",{children:e.jsxs(k,{className:"gap-1",value:d,size:"sm",onChange:t=>P(t),children:[e.jsx(k.Item,{value:"all",children:"All"}),e.jsx(k.Item,{value:"campagin",children:"Campagin"}),e.jsx(k.Item,{value:"email",children:"Email"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(W,{options:{chart:{type:"line",zoom:{enabled:!1},toolbar:{show:!1}},legend:{show:!1},stroke:{width:d==="email"?2.5:[0,2.5],curve:"smooth",lineCap:"round"},states:{hover:{filter:{type:"none"}}},tooltip:{custom:({series:t,dataPointIndex:a})=>{const i=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${y[9]}"></div>
                  <div class="flex gap-2">Campaign: <span class="font-bold">${t[0][a]}</span></div>
                </div>`,m=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${y[0]}"></div>
                  <div class="flex gap-2">Email: <span class="font-bold">${t[d==="all"?1:0][a]}</span></div>
                </div>`,r=d==="all"?`${i()}${m()}`:d==="campagin"?i():m();return`
                <div class="py-2 px-4 rounded-xl">
                  <div class="flex flex-col gap-2">
                    <div>${C.label[a]}</div>
                    ${r}
                  </div>
                </div>`}},labels:C.label,yaxis:d==="all"?[{},{opposite:!0}]:[],plotOptions:{bar:{horizontal:!1,columnWidth:"35px",borderRadius:4,borderRadiusApplication:"end"}}},series:_,height:450})})]})]})]})}export{ne as default};
