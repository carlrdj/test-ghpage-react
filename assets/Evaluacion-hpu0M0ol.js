import{b as c,j as e}from"./index-zJlaE_HK.js";import{C as P}from"./Card-C-Mn8nma.js";import{S}from"./toast-B7PgVsN2.js";import{C as N,M as B,A as W,e as G,b as K}from"./MonitoreService-he35y15f.js";import"./Drawer-B_J86z6-.js";import"./Button-C6uDY6Lx.js";import"./FormContainer-4XNfbORA.js";import"./uniqueId-FWsYeQHm.js";import{S as V}from"./Select-BBW6A9hW.js";const w={campagin:[440,505,414,671,227,413,201,352,752,320,257,160],email:[23,42,35,27,43,22,17,31,22,22,12,16],label:["01 Jan","02 Jan","03 Jan","04 Jan","05 Jan","06 Jan","07 Jan","08 Jan","09 Jan","10 Jan","11 Jan","12 Jan"]},M=["Monitoreo","Seguimiento","Supervision"],E=u=>{const o=Array(M.length).fill(0);return u.forEach(i=>i.forEach((p,s)=>o[s]+=p)),o};function q(u){let o=[];const i=(p,s)=>p.find(d=>d.nombre==s)?.calculo||0;for(let p=0;p<u.length;p++){const s=u[p],d=o.findIndex(g=>g.id==s.departamento.iddpto);if(d===-1){o.push({id:s.departamento.iddpto,nombre:s.departamento.nombre,provincias:[{id:s.provincia.idprov,nombre:s.provincia.nombre,distritos:[{id:s.distrito.ubigeo,nombre:s.distrito.distrito,valores:[i(s.respuestas,"Monitoreo"),i(s.respuestas,"Seguimiento"),i(s.respuestas,"Supervision")]}]}]});continue}const f=o[d].provincias.findIndex(g=>g.id==s.provincia.idprov);if(f===-1){o[d].provincias.push({id:s.provincia.idprov,nombre:s.provincia.nombre,distritos:[{id:s.distrito.ubigeo,nombre:s.distrito.distrito,valores:[i(s.respuestas,"Monitoreo"),i(s.respuestas,"Seguimiento"),i(s.respuestas,"Supervision")]}]});continue}const j=o[d].provincias[f].distritos.findIndex(g=>g.id==s.distrito.ubigeo);if(j===-1){o[d].provincias[f].distritos.push({id:s.distrito.ubigeo,nombre:s.distrito.distrito,valores:[i(s.respuestas,"Monitoreo"),i(s.respuestas,"Seguimiento"),i(s.respuestas,"Supervision")]});continue}o[d].provincias[f].distritos[j].valores=[i(s.respuestas,"Monitoreo"),i(s.respuestas,"Seguimiento"),i(s.respuestas,"Supervision")]}return o}function se(){const[u,o]=c.useState(new Set),[i,p]=c.useState([]),[s,d]=c.useState([]),[f,j]=c.useState(null),[g,y]=c.useState(!0),[D,C]=c.useState("Peru");async function z(t){t&&(y(!0),j(t),await J(t.value),y(!1))}async function J(t){const a=await G(t);p(q(a))}async function O(){const t=await K();d(t.map(n=>({value:String(n.id),label:n.nombre})));const a=t[0];j({value:String(a.id),label:a.nombre}),await J(String(a.id)),y(!1)}c.useEffect(()=>{O()},[]);const T=t=>{const a=new Set(u);a.has(t)?a.delete(t):a.add(t),o(a)};function k(t,a){const n=t.reduce((l,r)=>l+r,0);return Number((n/a*100).toFixed(2))}const{provTotals:L,depTotals:R}=c.useMemo(()=>{const t=new Map,a=new Map;for(const n of i){const l=[];for(const x of n.provincias){const b=E(x.distritos.map(v=>v.valores));t.set(x.id,{cols:b,total:k(b,4*x.distritos.length)}),l.push(...x.distritos.map(v=>v.valores))}const r=E(l);a.set(n.id,{cols:r,total:k(r,4*l.length)})}return{provTotals:t,depTotals:a}},[i]),[m,A]=c.useState("all"),I=c.useMemo(()=>{const t={name:"Campaign (ROI)",type:"column",data:w.campagin,color:function({dataPointIndex:n,value:l}){return n>0&&l<w.campagin[n-1]?N[7]:N[9]}},a={name:"Email (ROI)",type:"line",data:w.email,color:N[0]};return m==="all"?[t,a]:m==="campagin"?[t]:m==="email"?[a]:[]},[m]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-center",children:e.jsx(V,{options:s,value:f,onChange:t=>z(t),isDisabled:g})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:e.jsxs("table",{className:"table-fixed border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 min-w-[240px] max-w-[240px] bg-slate-50 p-3 text-left text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:"Localización"}),M.map(t=>e.jsx("th",{className:"bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:t},t)),e.jsx("th",{className:"w-[120px] bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200 whitespace-nowrap",children:"Total %"})]})}),e.jsx("tbody",{children:i.map(t=>{const a=`D:${t.id}`,n=u.has(a),l=R.get(t.id);return e.jsxs(c.Fragment,{children:[e.jsxs("tr",{className:"bg-amber-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{T(a),C(`${t.nombre}, Peru`)},"aria-expanded":n,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${n?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:t.nombre})]})}),l?.cols?.map((r,x)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:r},x)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:l?.total})]}),n&&t.provincias.map(r=>{const x=`P:${r.id}`,b=u.has(x),v=L.get(r.id);return e.jsxs(c.Fragment,{children:[e.jsxs("tr",{className:"bg-cyan-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 pl-10 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{T(x),C(`${r.nombre}, ${t.nombre}, Peru`)},"aria-expanded":b,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${b?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:r.nombre})]})}),v.cols.map((h,$)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:h},$)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:v.total})]}),b&&r.distritos.map(h=>e.jsxs("tr",{className:"hover:bg-slate-50 bg-emerald-50",children:[e.jsx("td",{onClick:()=>{C(`${h.nombre}, ${r.nombre}, ${t.nombre}, Peru`)},className:"sticky left-0 z-10 p-3 pl-22 ring-1 ring-slate-200",children:e.jsx("span",{className:"ml-2 text-sm text-slate-800 underline decoration-emerald-300",children:h.nombre})}),h.valores.map(($,F)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:$},F)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:k(h.valores,4)})]},h.id))]},r.id)})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"bg-white p-3 text-right text-[11px] text-slate-500 ring-1 ring-slate-200"}),e.jsxs("td",{colSpan:M.length,className:"bg-white p-3 text-center text-[11px] text-slate-500 ring-1 ring-slate-200",children:["Valor de clasificación:"," ",e.jsx("span",{className:"font-medium",children:"0 / 1"})]}),e.jsx("td",{className:"bg-white p-3 ring-1 ring-slate-200"})]})})]})})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6 items-stretch",children:[e.jsx("div",{className:"relative min-h-[450px] rounded-xl overflow-hidden ring-1 ring-slate-200 bg-slate-100",children:e.jsx(B,{query:D})}),e.jsxs(P,{className:"h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{children:"Ads performance"}),e.jsx("div",{children:e.jsxs(S,{className:"gap-1",value:m,size:"sm",onChange:t=>A(t),children:[e.jsx(S.Item,{value:"all",children:"All"}),e.jsx(S.Item,{value:"campagin",children:"Campagin"}),e.jsx(S.Item,{value:"email",children:"Email"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(W,{options:{chart:{type:"line",zoom:{enabled:!1},toolbar:{show:!1}},legend:{show:!1},stroke:{width:m==="email"?2.5:[0,2.5],curve:"smooth",lineCap:"round"},states:{hover:{filter:{type:"none"}}},tooltip:{custom:({series:t,dataPointIndex:a})=>{const n=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${N[9]}"></div>
                  <div class="flex gap-2">Campaign: <span class="font-bold">${t[0][a]}</span></div>
                </div>`,l=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${N[0]}"></div>
                  <div class="flex gap-2">Email: <span class="font-bold">${t[m==="all"?1:0][a]}</span></div>
                </div>`,r=m==="all"?`${n()}${l()}`:m==="campagin"?n():l();return`
                <div class="py-2 px-4 rounded-xl">
                  <div class="flex flex-col gap-2">
                    <div>${w.label[a]}</div>
                    ${r}
                  </div>
                </div>`}},labels:w.label,yaxis:m==="all"?[{},{opposite:!0}]:[],plotOptions:{bar:{horizontal:!1,columnWidth:"35px",borderRadius:4,borderRadiusApplication:"end"}}},series:I,height:450})})]})]})]})}export{se as default};
