import{b as l,j as e}from"./index-BTIbGg6b.js";import{C as P}from"./Card-Qv0gR66p.js";import{S as y}from"./toast-DLJmkGzs.js";import{C as N,M as _,A as B,d as W,b as G}from"./MonitoreService-Jhq63LXC.js";import"./Drawer-y_O075Ou.js";import"./Button-B29EPoIq.js";import"./FormContainer-CD-ONq0O.js";import"./uniqueId-Btf1eO11.js";import{S as K}from"./Select-76P-_cyt.js";const w={campagin:[440,505,414,671,227,413,201,352,752,320,257,160],email:[23,42,35,27,43,22,17,31,22,22,12,16],label:["01 Jan","02 Jan","03 Jan","04 Jan","05 Jan","06 Jan","07 Jan","08 Jan","09 Jan","10 Jan","11 Jan","12 Jan"]},J=["Actividades","Programas","Proyectos","Otros"],M=x=>{const r=Array(J.length).fill(0);return x.forEach(c=>c.forEach((m,s)=>r[s]+=m)),r};function V(x){let r=[];const c=m=>m.map(s=>s.respuesta.toLowerCase()==="si"?parseFloat(s.promedio):0);for(let m=0;m<x.length;m++){const s=x[m],g=r.findIndex(h=>h.id==s.departamento_iddpto);if(g===-1){r.push({id:s.departamento_iddpto,nombre:s.departamento.nombre,provincias:[{id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.secciones)}]}]});continue}const f=r[g].provincias.findIndex(h=>h.id==s.provincia_idprov);if(f===-1){r[g].provincias.push({id:s.provincia_idprov,nombre:s.provincia.nombre,distritos:[{id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.secciones)}]});continue}const j=r[g].provincias[f].distritos.findIndex(h=>h.id==s.ubigeo);if(j===-1){r[g].provincias[f].distritos.push({id:s.ubigeo,nombre:s.distrito.distrito,valores:c(s.secciones)});continue}r[g].provincias[f].distritos[j].valores=c(s.secciones)}return r}function se(){const[x,r]=l.useState(new Set),[c,m]=l.useState([]),[s,g]=l.useState([]),[f,j]=l.useState(null),[h,C]=l.useState(!0),[D,S]=l.useState("Peru");async function O(t){t&&(C(!0),j(t),await T(t.value),C(!1))}async function T(t){const a=await W(t);m(V(a))}async function z(){const t=await G();g(t.map(i=>({value:String(i.id),label:i.nombre})));const a=t[0];j({value:String(a.id),label:a.nombre}),await T(String(a.id)),C(!1)}l.useEffect(()=>{z()},[]);const E=t=>{const a=new Set(x);a.has(t)?a.delete(t):a.add(t),r(a)};function k(t,a){const i=t.reduce((o,n)=>o+n,0);return Number((i/a).toFixed(2))}const{provTotals:L,depTotals:A}=l.useMemo(()=>{const t=new Map,a=new Map;for(const i of c){const o=[];for(const p of i.provincias){const b=M(p.distritos.map(v=>v.valores));t.set(p.id,{cols:b,total:k(b,4*p.distritos.length)}),o.push(...p.distritos.map(v=>v.valores))}const n=M(o);a.set(i.id,{cols:n,total:k(n,4*o.length)})}return{provTotals:t,depTotals:a}},[c]),[d,R]=l.useState("all"),F=l.useMemo(()=>{const t={name:"Campaign (ROI)",type:"column",data:w.campagin,color:function({dataPointIndex:i,value:o}){return i>0&&o<w.campagin[i-1]?N[7]:N[9]}},a={name:"Email (ROI)",type:"line",data:w.email,color:N[0]};return d==="all"?[t,a]:d==="campagin"?[t]:d==="email"?[a]:[]},[d]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"text-center",children:e.jsx(K,{options:s,value:f,onChange:t=>O(t),isDisabled:h})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-[1000px] table-fixed border-separate border-spacing-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 min-w-[240px] max-w-[240px] bg-slate-50 p-3 text-left text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:"Localización"}),J.map(t=>e.jsx("th",{className:"bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200",children:t},t)),e.jsx("th",{className:"w-[120px] bg-slate-50 p-3 text-center text-[12px] font-semibold uppercase tracking-wide text-slate-600 ring-1 ring-slate-200 whitespace-nowrap",children:"Total %"})]})}),e.jsx("tbody",{children:c.map(t=>{const a=`D:${t.id}`,i=x.has(a),o=A.get(t.id);return e.jsxs(l.Fragment,{children:[e.jsxs("tr",{className:"bg-amber-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{E(a),S(`${t.nombre}, Peru`)},"aria-expanded":i,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${i?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:t.nombre})]})}),o?.cols?.map((n,p)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:n},p)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:o?.total})]}),i&&t.provincias.map(n=>{const p=`P:${n.id}`,b=x.has(p),v=L.get(n.id);return e.jsxs(l.Fragment,{children:[e.jsxs("tr",{className:"bg-cyan-50 hover:bg-slate-50/60",children:[e.jsx("td",{className:"sticky left-0 z-10 p-3 pl-10 ring-1 ring-slate-200",children:e.jsxs("button",{type:"button",onClick:()=>{E(p),S(`${n.nombre}, ${t.nombre}, Peru`)},"aria-expanded":b,className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:`h-4 w-4 transform transition-transform ${b?"rotate-90":""}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:n.nombre})]})}),v.cols.map((u,$)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:u},$)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:v.total})]}),b&&n.distritos.map(u=>e.jsxs("tr",{className:"hover:bg-slate-50 bg-emerald-50",children:[e.jsx("td",{onClick:()=>{S(`${u.nombre}, ${n.nombre}, ${t.nombre}, Peru`)},className:"sticky left-0 z-10 p-3 pl-22 ring-1 ring-slate-200",children:e.jsx("span",{className:"ml-2 text-sm text-slate-800 underline decoration-emerald-300",children:u.nombre})}),u.valores.map(($,I)=>e.jsx("td",{className:"p-3 text-center text-sm text-slate-700 ring-1 ring-slate-200",children:$},I)),e.jsx("td",{className:"p-3 text-center text-sm font-semibold text-slate-800 ring-1 ring-slate-200",children:k(u.valores,4)})]},u.id))]},n.id)})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"bg-white p-3 text-right text-[11px] text-slate-500 ring-1 ring-slate-200"}),e.jsxs("td",{colSpan:J.length,className:"bg-white p-3 text-center text-[11px] text-slate-500 ring-1 ring-slate-200",children:["Valor de clasificación:"," ",e.jsx("span",{className:"font-medium",children:"0 / 1"})]}),e.jsx("td",{className:"bg-white p-3 ring-1 ring-slate-200"})]})})]})})})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6 items-stretch",children:[e.jsx("div",{className:"relative min-h-[450px] rounded-xl overflow-hidden ring-1 ring-slate-200 bg-slate-100",children:e.jsx(_,{query:D})}),e.jsxs(P,{className:"h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{children:"Ads performance"}),e.jsx("div",{children:e.jsxs(y,{className:"gap-1",value:d,size:"sm",onChange:t=>R(t),children:[e.jsx(y.Item,{value:"all",children:"All"}),e.jsx(y.Item,{value:"campagin",children:"Campagin"}),e.jsx(y.Item,{value:"email",children:"Email"})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(B,{options:{chart:{type:"line",zoom:{enabled:!1},toolbar:{show:!1}},legend:{show:!1},stroke:{width:d==="email"?2.5:[0,2.5],curve:"smooth",lineCap:"round"},states:{hover:{filter:{type:"none"}}},tooltip:{custom:({series:t,dataPointIndex:a})=>{const i=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${N[9]}"></div>
                  <div class="flex gap-2">Campaign: <span class="font-bold">${t[0][a]}</span></div>
                </div>`,o=()=>`
                <div class="flex items-center gap-2">
                  <div class="h-[10px] w-[10px] rounded-full" style="background-color: ${N[0]}"></div>
                  <div class="flex gap-2">Email: <span class="font-bold">${t[d==="all"?1:0][a]}</span></div>
                </div>`,n=d==="all"?`${i()}${o()}`:d==="campagin"?i():o();return`
                <div class="py-2 px-4 rounded-xl">
                  <div class="flex flex-col gap-2">
                    <div>${w.label[a]}</div>
                    ${n}
                  </div>
                </div>`}},labels:w.label,yaxis:d==="all"?[{},{opposite:!0}]:[],plotOptions:{bar:{horizontal:!1,columnWidth:"35px",borderRadius:4,borderRadiusApplication:"end"}}},series:F,height:450})})]})]})]})}export{se as default};
